# 接口文档

| 名称 | 功能说明 | 类型 | 默认 | 版本 |
| --- | --- | --- | --- | --- |
| login | 跳转到oauth认证页去登陆 | `function(auth: AUTH, params?: LoginParams)` | - |  |
| logout | 登出 | `function(reload = true)` | - |  |
| token | 获取access-token | `string` | `undefined` |  |
| requestToken | 用code换取token | `function(params?: ReqTokenParams, persistence = true)` | - |  |
| getUserInfo | 获取用户信息 | `function(token?: string)` | - |  |
| getContext | 在 mixin app 内获取上下文对象 | `function()` | - |  |
| reloadTheme | 重载 mixin 的主体色 | `function()` | - |  |
| playlist | 用原生播放器播放音频 | `function(src: string[])` | - | `0.3.0` |

### login
跳转到 oauth 页面，让并让用户授权登陆，而后重定向回到指定 `redirect_url` 的页面中

- 参数类型
  ```typescript
  type AUTH = {
    phone?: boolean; // 获取用户手机号
    profile?: boolean; // 获取用户详细信息
    contacts?: boolean; // 获取用户通讯录
    assets?: boolean; // 获取用户手资产情况
    snapshots?: boolean; // 获取用户截图
    messages?: boolean; // 获取用户消息
    represent?: boolean; // 获取用户截图授权
  };

  type LoginParams = {
    client_id?: string;
    redirect_url?: string;
    state?: string;
  };

  bridge.login(auth: Auth, params?: LoginParams);
  ```

- 使用示例
  ```typescript
  const auth = {
    phone: true,
    profile: true,
    contacts: false,
    assets: true,
    snapshots: false
  }

  bridge.login(auth, { redirect_url: 'https://localhost:3000' });
  ```

### logout
登出

- 使用示例
  ```typescript
  const isReload = false;
  bridge.logout(isReload);
  ```

### token
获取 `access-token`，当然一开始得先调用 `requestToken` 来换取 token

- 使用示例
  ```typescript
  const token = bridge.token;
  ```


### requestToken
用授权登陆返回的 `code`，换取 `access-token`


- 参数类型
  ```typescript
  type ReqTokenParams = {
    code?: string;
    client_id?: string;
    code_verifier?: string;
  },  = true

  // persistence 是否做持久化，默认 true
  bridge.requestToken(params?: ReqTokenParams, persistence?: boolean);
  ```

- 使用示例
  ```typescript
  (async function () {
    await bridge.requestToken();
    console.info(bridge.token);
  });
  ```

### getUserInfo
获取用户信息，请确保 `access_token` 有效

- 使用示例
  ```typescript
  const userInfo = await bridge.getUserInfo();
  ```

### getContext
在 Mixin App 中，获取当前上下文内容

- 使用示例
  ```typescript
  const ctx = bridge.getContext();
  ```

### reloadTheme
根据定义的  `<meta>` 标签中的 `theme-color` 来重载 mixin app 的主体色

- 使用示例
  ```html
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <!-- ... -->
      <meta name="theme-color" content="#ff64b1">
    </head>
    <body>
      <!-- ... -->
  </html>
  ```

  ```typescript
  bridge.reloadTheme();
  ```

### playlist
用原生播放器播放音频

- 使用示例
  ```typescript
  bridge.playlist([
    'https://audio.1.mp3',
    'https://audio.2.mp3',
    'https://audio.3s.mp3',
  ]);
  ```